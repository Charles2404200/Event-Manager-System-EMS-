<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Pane?>
<?import javafx.scene.control.*?>
<?import javafx.geometry.Insets?>

<BorderPane xmlns="http://javafx.com/javafx" xmlns:fx="http://javafx.com/fxml"
            fx:controller="org.ems.ui.controller.TicketManagerController"
            prefWidth="1400" prefHeight="900">

    <top>
        <VBox style="-fx-background-color: #2c3e50; -fx-padding: 15;" spacing="10">
            <Label text="Manage Tickets" style="-fx-font-size: 24; -fx-font-weight: bold; -fx-text-fill: white;"/>
            <Label text="Create ticket types and assign tickets to attendees" style="-fx-font-size: 12; -fx-text-fill: #ecf0f1;"/>
        </VBox>
    </top>

    <center>
        <TabPane prefHeight="800" style="-fx-padding: 10;">

            <!-- TAB 1: Ticket Templates -->
            <Tab text="Ticket Templates" closable="false">
                <VBox spacing="15" style="-fx-padding: 20;">

                    <Label text="Create Ticket Types and Prices for Events/Sessions" style="-fx-font-size: 14; -fx-font-weight: bold;"/>

                    <!-- Create Template Section -->
                    <HBox spacing="10" style="-fx-border-color: #cccccc; -fx-border-width: 1; -fx-padding: 15; -fx-border-radius: 5;">
                        <Label text="Event:" style="-fx-font-size: 12;"/>
                        <ComboBox fx:id="templateEventCombo" prefWidth="200" style="-fx-padding: 8;"/>

                        <Label text="Session:" style="-fx-font-size: 12;"/>
                        <ComboBox fx:id="templateSessionCombo" prefWidth="200" style="-fx-padding: 8;"/>

                        <Label text="Type:" style="-fx-font-size: 12;"/>
                        <ComboBox fx:id="templateTypeCombo" prefWidth="120" style="-fx-padding: 8;"/>

                        <Label text="Price:" style="-fx-font-size: 12;"/>
                        <TextField fx:id="templatePriceField" promptText="e.g. 50.00" prefWidth="100" style="-fx-padding: 8;"/>

                        <Button text="Create Template" style="-fx-padding: 8; -fx-cursor: hand; -fx-background-color: #27ae60; -fx-text-fill: white;" onAction="#onCreateTemplate"/>
                    </HBox>

                    <!-- Templates Table + Pagination -->
                    <VBox style="-fx-border-color: #cccccc; -fx-border-width: 1; -fx-padding: 10; -fx-border-radius: 5;" spacing="5">
                        <Label text="Available Ticket Templates" style="-fx-font-size: 12; -fx-font-weight: bold; -fx-padding: 5;"/>
                        <TableView fx:id="templatesTable" prefHeight="300">
                            <columns>
                                <TableColumn text="Event" prefWidth="200"/>
                                <TableColumn text="Session" prefWidth="200"/>
                                <TableColumn text="Type" prefWidth="100"/>
                                <TableColumn text="Price" prefWidth="100"/>
                                <TableColumn text="Available" prefWidth="100"/>
                            </columns>
                        </TableView>

                        <HBox spacing="10" alignment="CENTER_LEFT" style="-fx-padding: 5 10 0 10;">
                            <Label fx:id="templatesCountLabel" text="Total Templates: 0" style="-fx-font-size: 11; -fx-text-fill: #666;"/>
                            <Pane HBox.hgrow="ALWAYS"/>
                            <Button text="⟲ Refresh" onAction="#onTemplatesRefresh" style="-fx-padding: 8 15; -fx-cursor: hand;"/>
                            <Label fx:id="templatesPageLabel" text="(Keyset Pagination)" style="-fx-font-size: 11; -fx-text-fill: #666;"/>
                        </HBox>
                    </VBox>
                </VBox>
            </Tab>

            <!-- TAB 2: Assign Tickets -->
            <Tab text="Assign Tickets" closable="false" onSelectionChanged="#onAssignedTabSelected">
                <VBox spacing="15" style="-fx-padding: 20;">

                    <Label text="Assign Tickets to Attendees" style="-fx-font-size: 14; -fx-font-weight: bold;"/>

                    <!-- Loading Progress Bar -->
                    <VBox spacing="5" style="-fx-padding: 10; -fx-background-color: #34495e; -fx-border-radius: 5;" visible="false" fx:id="assignedLoadingContainer">
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <ProgressBar fx:id="assignedLoadingProgressBar" prefWidth="300" visible="false" style="-fx-padding: 2;"/>
                            <Label fx:id="assignedLoadingStatusLabel" text="Loading..." style="-fx-text-fill: white; -fx-font-size: 12;" visible="false"/>
                        </HBox>
                    </VBox>

                    <!-- Search and Filter -->
                    <HBox spacing="10" style="-fx-border-color: #cccccc; -fx-border-width: 1; -fx-padding: 15; -fx-border-radius: 5;">
                        <Label text="Attendee:" style="-fx-font-size: 12;"/>
                        <ComboBox fx:id="assignAttendeeCombo" prefWidth="250" style="-fx-padding: 8;"/>

                        <Label text="Template:" style="-fx-font-size: 12;"/>
                        <ComboBox fx:id="assignTemplateCombo" prefWidth="250" style="-fx-padding: 8;"/>

                        <Button text="Assign Ticket" style="-fx-padding: 8; -fx-cursor: hand; -fx-background-color: #27ae60; -fx-text-fill: white;" onAction="#onAssignTicket"/>
                    </HBox>

                    <!-- Assigned Tickets Table + Pagination -->
                    <VBox style="-fx-border-color: #cccccc; -fx-border-width: 1; -fx-padding: 10; -fx-border-radius: 5;" spacing="5">
                        <Label text="Assigned Tickets" style="-fx-font-size: 12; -fx-font-weight: bold; -fx-padding: 5;"/>
                        <TableView fx:id="assignedTicketsTable" prefHeight="300">
                            <columns>
                                <TableColumn text="Ticket ID" prefWidth="160"/>
                                <TableColumn text="Attendee" prefWidth="180"/>
                                <TableColumn text="Event" prefWidth="150"/>
                                <TableColumn text="Session" prefWidth="150"/>
                                <TableColumn text="Type" prefWidth="100"/>
                                <TableColumn text="Price" prefWidth="100"/>
                                <TableColumn text="Status" prefWidth="100"/>
                            </columns>
                        </TableView>

                        <HBox spacing="10" alignment="CENTER_LEFT" style="-fx-padding: 5 10 0 10;">
                            <Label fx:id="assignedCountLabel" text="Total Assigned: 0" style="-fx-font-size: 11; -fx-text-fill: #666;"/>
                            <Pane HBox.hgrow="ALWAYS"/>
                            <Button text="⟲ Refresh" onAction="#onAssignedRefresh" style="-fx-padding: 8 15; -fx-cursor: hand;"/>
                            <Label fx:id="assignedPageLabel" text="(Keyset Pagination)" style="-fx-font-size: 11; -fx-text-fill: #666;"/>
                        </HBox>

                        <!-- Pagination Controls -->
                        <HBox spacing="10" alignment="CENTER" style="-fx-padding: 10 10 0 10;">
                            <Button fx:id="assignedPrevButton" text="← Previous" style="-fx-padding: 8 15; -fx-cursor: hand; -fx-font-size: 11;" onAction="#onAssignedPrevPage"/>

                            <!-- Page buttons container -->
                            <HBox fx:id="assignedPaginationBox" spacing="5" alignment="CENTER">
                                <!-- Page buttons will be dynamically added here -->
                            </HBox>

                            <Button fx:id="assignedNextButton" text="Next →" style="-fx-padding: 8 15; -fx-cursor: hand; -fx-font-size: 11;" onAction="#onAssignedNextPage"/>

                            <Label fx:id="assignedPageInfoLabel" text="Page 1 of 1" style="-fx-font-size: 11; -fx-text-fill: #666; -fx-padding: 0 10 0 10;"/>
                        </HBox>
                    </VBox>

                    <!-- Statistics -->
                    <HBox spacing="15" style="-fx-padding: 10;">
                        <VBox style="-fx-border-color: #3498db; -fx-border-width: 1; -fx-padding: 15; -fx-border-radius: 5; -fx-background-color: #ecf0f1;" spacing="5" prefWidth="150">
                            <Label text="Total Assigned" style="-fx-font-size: 12; -fx-text-fill: #2c3e50;"/>
                            <Label fx:id="totalAssignedLabel" text="0" style="-fx-font-size: 24; -fx-font-weight: bold; -fx-text-fill: #3498db;"/>
                        </VBox>
                        <VBox style="-fx-border-color: #2ecc71; -fx-border-width: 1; -fx-padding: 15; -fx-border-radius: 5; -fx-background-color: #ecf0f1;" spacing="5" prefWidth="150">
                            <Label text="Active Tickets" style="-fx-font-size: 12; -fx-text-fill: #2c3e50;"/>
                            <Label fx:id="activeAssignedLabel" text="0" style="-fx-font-size: 24; -fx-font-weight: bold; -fx-text-fill: #2ecc71;"/>
                        </VBox>
                        <VBox style="-fx-border-color: #e74c3c; -fx-border-width: 1; -fx-padding: 15; -fx-border-radius: 5; -fx-background-color: #ecf0f1;" spacing="5" prefWidth="150">
                            <Label text="Total Revenue" style="-fx-font-size: 12; -fx-text-fill: #2c3e50;"/>
                            <Label fx:id="totalRevenueLabel" text="0" style="-fx-font-size: 24; -fx-font-weight: bold; -fx-text-fill: #e74c3c;"/>
                        </VBox>
                    </HBox>
                </VBox>
            </Tab>

        </TabPane>
    </center>

    <bottom>
        <HBox spacing="10" style="-fx-padding: 10;">
            <Button text="Back to Dashboard" style="-fx-padding: 10; -fx-font-size: 12; -fx-cursor: hand;" onAction="#onBack"/>
        </HBox>
    </bottom>

</BorderPane>
